<?php


namespace Dictionary\Obj;

use Dictionary\BuilderInterface;
use Dictionary\File;
use Gettext\Translations;

class Obj implements BuilderInterface
{
    const FILE = __DIR__ . '/autogenerated-translated.obj.php';

    public function build(Translations $phrases): void
    {
        $file = new File(self::FILE);
        $file->write('<?php return new class {');
        $i = 0;
        foreach ($phrases as $translation) {
            $i++;
            $forms = $translation->getPluralTranslations();
            if ($forms === []) {
                $forms[0] = $translation->getTranslation();
            }
            foreach ($forms as $form => $phrase) {
                $id = 'v' . crc32($translation->getOriginal() . '::form' . $form);
                $file->write(
                    'public $' . $id . ' = \'' . addslashes($phrase) . '\';'
                    . ' ### ' . str_replace("\n", " ", $phrase)
                );
            }
        }
        $file->write('};');
    }
}