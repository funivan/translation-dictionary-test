<?php


namespace Dictionary\Obj;

use Dictionary\BuilderInterface;
use Dictionary\File;
use Dictionary\PhraseTranslations;
use Gettext\Translations;

class Obj implements BuilderInterface
{
    const FILE = __DIR__ . '/autogenerated-translations.obj.php';

    final public function build(Translations $phrases): void
    {
        $file = new File(self::FILE);
        $file->write('<?php return new class {');
        $i = 0;
        foreach (new PhraseTranslations($phrases) as $phrase) {
            $i++;
            $id = 'v' . md5($phrase->getOrigin()) . '_f' . $phrase->getForm();
            $file->write(
                'public $' . $id . ' = \'' . addslashes($phrase->getTranslation()) . '\';'
                . ' ### ' . str_replace("\n", " ", $phrase->getOrigin())
            );
        }
        $file->write('};');
    }
}